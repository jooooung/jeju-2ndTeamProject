<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lec.jeju.dao.BusinessDao">
	<resultMap type="Business" id="BusinessResult">
		<result property="bid" column="bid" />
		<result property="bpw" column="bpw" />
		<result property="bname" column="bname" />
		<result property="btel" column="btel" />
		<result property="bemail" column="bemail" />
		<result property="baddr" column="baddr" />
		<result property="bdeaddr" column="bdeaddr" />
		<result property="bpost" column="bpost" />
		<result property="bphoto" column="bphoto" />
		<result property="brdate" column="brdate" />
	</resultMap>
	<!-- ID 중복체크 -->
	<select id="idConfirm" parameterType="String" resultType="int">
		SELECT COUNT(*) FROM Business WHERE bid = #{bid, jdbcType=VARCHAR}
	</select>
	
	<!-- 이메일 중복체크 -->
	<select id="emailConfirm" parameterType="String" resultType="int">
	    SELECT COUNT(*) FROM Business WHERE bemail = #{bemail, jdbcType=VARCHAR}
	</select>

	
	<!-- 회원가입 -->
	<insert id="joinBusiness" parameterType="Business">
	insert into Business (bid, bpw, bname, btel, bemail, baddr, bdeaddr, bpost, bphoto)
    values(#{bid}, #{bpw}, #{bname}, #{btel}, #{bemail}, #{baddr}, #{bdeaddr}, #{bpost}, #{bphoto, jdbcType=VARCHAR})
	</insert>

	<!-- 로그인 -->
	<select id="loginCheck" parameterType="Business" resultType="Business">
		SELECT * FROM Business WHERE bid=#{bid} AND bpw=#{bpw}
	</select>

	<!-- 상세보기 -->
	<select id="getDetailBusiness" parameterType="String" resultType="Business">
		SELECT * FROM Business WHERE bid = #{bid}
	</select>

	<!-- 정보수정 -->
	<update id="modifyBusiness" parameterType="Business"> 
	UPDATE Business SET 
        bpw = #{bpw},
        bname = #{bname},
        bemail = #{bemail},
        baddr = #{baddr},
        bdeaddr = #{bdeaddr},
        bpost = #{bpost},
		bphoto = #{bphoto}
    WHERE bid = #{bid, jdbcType=VARCHAR}
	</update>

    <!-- 업체 등록요청 (등록글 작성) -->
    <!-- Hotel 등록 -->
    <insert id="insertHotel" parameterType="Hotel">
        INSERT INTO Hotel (hName, bId, locationNo, hAddr, hTel, hLink, hInfo, inTime, outTime, hMainImg, hSubImg_1, hSubImg_2, hSubImg_3, hLatitude, hLongitude, hPrice, requestStatus)
        VALUES (#{hname}, #{bid}, #{locationno}, #{haddr}, #{htel}, #{hlink}, #{hinfo}, #{intime}, #{outtime}, #{hmainimg}, #{hsubimg_1}, #{hsubimg_2}, #{hsubimg_3}, #{hlatitude}, #{hlongitude}, #{hprice}, #{requeststatus})
    </insert>

    <!-- Restaurant 등록 -->
    <insert id="insertRestaurant" parameterType="Restaurant">
        INSERT INTO Restaurant (rName, bId, locationNo, rAddr, rTel, rLink, rInfo, rMenu, rMainImg, rSubImg_1, rSubImg_2, rSubImg_3, rLatitude, rLongitude, rPrice, requestStatus)
        VALUES (#{rname}, #{bid}, #{locationno}, #{raddr}, #{rtel}, #{rlink}, #{rinfo}, #{rmenu}, #{rmainImg}, #{rsubimg_1}, #{rsubimg_2}, #{rsubimg_3}, #{rlatitude}, #{rlongitude}, #{rprice}, #{requeststatus})
    </insert>

    <!-- 업체 등록요청 (등록글 수정) -->
    <!-- Hotel 수정 -->
    <update id="updateHotel" parameterType="Hotel">
        UPDATE Hotel
        SET hName = #{hName}, locationNo = #{locationNo}, hAddr = #{hAddr}, hTel = #{hTel}, hLink = #{hLink}, hInfo = #{hInfo}, inTime = #{inTime}, outTime = #{outTime},
            hMainImg = #{hmainimg}, hSubImg_1 = #{hsubimg_1}, hSubImg_2 = #{hsubimg_2}, hSubImg_3 = #{hsubimg_3}, hLatitude = #{hlatitude}, hLongitude = #{hlongitude}, hPrice = #{hprice}
        WHERE hName = #{hname} AND bId = #{bid}
    </update>

    <!-- Restaurant 수정 -->
    <update id="updateRestaurant" parameterType="Restaurant">
		UPDATE Restaurant
	    SET rName = #{rname}, locationNo = #{locationno}, rAddr = #{raddr}, rTel = #{rtel}, rLink = #{rlink}, rInfo = #{rinfo}, rMenu = #{rmenu}, rMainImg = #{rmainimg}, rSubImg_1 = #{rsubimg_1}, rSubImg_2 = #{rsubimg_2}, rSubImg_3 = #{rsubimg_3}, rLatitude = #{rlatitude}, rLongitude = #{rlongitude}, rPrice = #{rprice}
	    WHERE rName = #{rname}
	</update>
	
	<!-- Hotel 나의 글 조회 매퍼 -->
	<select id="selectMyHotelPosts" resultType="Hotel">
	    SELECT * FROM Hotel WHERE bId=#{bid}
	</select>
		
	<!-- Restaurant 나의 글 조회 매퍼 -->
	<select id="selectMyRestaurantPosts" resultType="Restaurant">
	    SELECT * FROM Restaurant WHERE bId=#{bid}
	</select>
	
	<!-- Hotel 나의 댓글 조회 매퍼 -->
	<select id="selectMyHotelComments" resultType="HotelComment">
	    SELECT * FROM hotelComment WHERE bId=#{bid}
	</select>
	
	<!-- Restaurant 나의 댓글 조회 매퍼 -->
<!-- 	<select id="selectMyRestaurantComments" resultType="RestaurantComment">
	    SELECT * FROM restaurantComment WHERE bId=#{bid}
	</select>
	 -->
	<!-- Hotel 등록 승인 여부 확인 매퍼 -->
	<select id="selectHotelApprovalStatus" resultType="Hotel">
	    SELECT requestStatus FROM Hotel WHERE hName=#{hname}
	</select>
	
	<!-- Restaurant 등록 승인 여부 확인 매퍼 -->
	<select id="selectRestaurantApprovalStatus" resultType="Restaurant">
	    SELECT requestStatus FROM Restaurant WHERE rName=#{rname}
	</select>
	
	<!-- Business 탈퇴 매퍼 -->
	<delete id="deleteBusiness" parameterType="String">
	    DELETE FROM Business WHERE bId=#{bid}
	</delete>
</mapper>